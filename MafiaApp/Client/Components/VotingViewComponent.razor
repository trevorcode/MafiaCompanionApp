@inject GameConnection connection


<h3>Day @connection.Room.GameState.DayCount - Voting</h3>

@if (connection.Room.IsHost(connection.GetConnectionId()))
{
    <div>
        <table>
            <tr>
                <th>Name</th>
                <th>Role</th>
                <th></th>
            </tr>
            @foreach (var p in connection.Room.GameState.Players)
            {

                @if (p.Role != RolesEnum.Host)
                {
                    <tr>
                        <td>
                            @p.RoomUser.Name
                        </td>
                        <td>
                            @p.Role
                        </td>
                        <td>
                            @if (connection.GetUserSelf().Role == RolesEnum.Host)
                            {
                                if (p.IsAlive)
                                {
                                    <button class="btn btn-warning">Dead</button>
                                }
                                else
                                {
                                    <button class="btn btn-warning">Make Alive</button>
                                }

                            }
                        </td>
                    </tr>
                }

            }

        </table>
    </div>
    <button class="btn-primary" @onclick="GoToNextGamePeriod">Go To Voting</button>
}
else
{
    <div>
        <table>
            <tr>
                <th>Name</th>
                <th>Role</th>
            </tr>
            @foreach (var p in connection.Room.GameState.Players)
            {

                @if (p.Role != RolesEnum.Host)
                {
                    <tr>
                        <td>
                            @p.RoomUser.Name
                        </td>
                        <td>
                            @if (p.Role == RolesEnum.Mafia && connection.GetUserSelf().Role == RolesEnum.Mafia)
                            {
                                <span> - Mafia</span>
                            }
                            @if (p.Role == RolesEnum.Detective && connection.GetUserSelf().Role == RolesEnum.Detective)
                            {
                                <span> - Detective</span>
                            }
                        </td>
                    </tr>
                }

            }

        </table>
    </div>
}


@code {
    protected override void OnInitialized()
    {
        connection.OnChange += StateHasChanged;
    }

    public void Dispose()
    {
        connection.OnChange -= StateHasChanged;
    }

    public async Task GoToNextGamePeriod()
    {
        await connection.GoToNextGamePeriod();
    }

    public async Task SelectPlayer(Player player)
    {
        //await connection.SelectPlayer(player);
    }
} 